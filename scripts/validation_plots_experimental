
import numpy as np
import matplotlib.pyplot as plt
import pickle
import simfarm
# from simfarm.stats import gauss3d, gauss2d_resp
# from scipy.optimize import curve_fit
from os.path import abspath, dirname, join


PARENT_DIR = dirname(dirname(abspath(__file__)))

with open(join(PARENT_DIR,'cultivar_models/Skyfall_Yield_model_daily_3d.pck'), 'rb') as pfile1:
    skyfall = pickle.load(pfile1)

def plot_validation(simfarm):
    fig = plt.figure()
    ax = fig.add_subplot(111)

    ax.scatter(np.arange(simfarm.preds.size), simfarm.resi, marker="+", label="Regions")
    # ax.axhline(np.mean(simfarm.resi), linestyle="-", color="k", label="Mean")
    # ax.axhline(np.median(simfarm.resi), linestyle="--", color="k", label="Median")

    ax.set_xlabel("Region")
    # ax.set_ylabel("$1 - Y_{\mathrm{Pred}} / Y_{\mathrm{True}}$ (%)")

    handles, labels = ax.get_legend_handles_labels()
    ax.legend(handles, labels)

    fig.savefig(
        join(
            PARENT_DIR, "scripts",
            f"Validation{simfarm.cult}.png"),
        bbox_inches="tight")

    return fig

# get the residual - mean
plot = plot_validation(skyfall)
plot.show()

# plot residual against the lat change the y: simfarm.resi

# plot against the long